<!DOCTYPE html>
<html lang="zh-CN">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
Â  Â  <title>Arcanum: Final Ritual</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- å…¨å±€æ ·å¼ (Global Styles) --- */
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  margin: 0;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  background-color: #000;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Cinzel', 'Noto Serif SC', serif;Â 
Â  Â  Â  Â  Â  Â  user-select: none;Â 
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
Â  Â  Â  Â  }
Â  Â  Â  Â  #canvas-container {Â 
Â  Â  Â  Â  Â  Â  width: 100vw;Â 
Â  Â  Â  Â  Â  Â  height: 100vh;Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  z-index: 1;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å¼•å…¥å­—ä½“ */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Noto+Serif+SC:wght@300;500&display=swap');

Â  Â  Â  Â  /* --- åˆå§‹ç•Œé¢ (Start Screen) --- */
Â  Â  Â  Â  #start-screen {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  background: radial-gradient(circle at center, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.95) 90%);
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  transition: opacity 1.5s cubic-bezier(0.25, 1, 0.5, 1);
Â  Â  Â  Â  Â  Â  color: #d4af37;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* æ ‡é¢˜åŠ¨ç”»ä¸æ ·å¼ */
Â  Â  Â  Â  .title-group {Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5vh;Â 
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  animation: floatTitle 6s ease-in-out infinite;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  h1 {Â 
Â  Â  Â  Â  Â  Â  font-size: 72px;Â 
Â  Â  Â  Â  Â  Â  margin: 0;Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 20px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 800;
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #fff 0%, #d4af37 50%, #996515 100%);
Â  Â  Â  Â  Â  Â  -webkit-background-clip: text;Â 
Â  Â  Â  Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.4));
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  h2 {Â 
Â  Â  Â  Â  Â  Â  font-size: 14px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 400;Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 8px;Â 
Â  Â  Â  Â  Â  Â  color: #a0a0a0;Â 
Â  Â  Â  Â  Â  Â  margin-top: 15px;Â 
Â  Â  Â  Â  Â  Â  text-transform: uppercase;Â 
Â  Â  Â  Â  Â  Â  opacity: 0.8;
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(212, 175, 55, 0.3);Â 
Â  Â  Â  Â  Â  Â  display: inline-block;Â 
Â  Â  Â  Â  Â  Â  padding-top: 15px;Â 
Â  Â  Â  Â  Â  Â  width: 120%;Â 
Â  Â  Â  Â  Â  Â  margin-left: -10%;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes floatTitle {
Â  Â  Â  Â  Â  Â  0%, 100% { transform: translateY(0); }
Â  Â  Â  Â  Â  Â  50% { transform: translateY(-10px); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* é€‰é¡¹æŒ‰é’®ç½‘æ ¼ */
Â  Â  Â  Â  .options-grid {Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;Â 
Â  Â  Â  Â  Â  Â  gap: 60px;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5vh;Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  animation: fadeUp 1s ease-out 0.5s forwards;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .option-group {Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  gap: 20px;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .option-label {Â 
Â  Â  Â  Â  Â  Â  font-size: 11px;Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 3px;Â 
Â  Â  Â  Â  Â  Â  color: #666;Â 
Â  Â  Â  Â  Â  Â  text-transform: uppercase;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* èƒ¶å›ŠæŒ‰é’®æ ·å¼ */
Â  Â  Â  Â  .choice-btn {
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.03);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(212, 175, 55, 0.3);Â 
Â  Â  Â  Â  Â  Â  color: #888;
Â  Â  Â  Â  Â  Â  padding: 12px 0;Â 
Â  Â  Â  Â  Â  Â  width: 160px;
Â  Â  Â  Â  Â  Â  font-family: inherit;Â 
Â  Â  Â  Â  Â  Â  font-size: 12px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
Â  Â  Â  Â  Â  Â  border-radius: 50px;Â 
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(2px);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .choice-btn.active {Â 
Â  Â  Â  Â  Â  Â  border-color: #d4af37;Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  Â  background: rgba(212, 175, 55, 0.15);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 25px rgba(212, 175, 55, 0.15);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .choice-btn:hover {Â 
Â  Â  Â  Â  Â  Â  border-color: #fff;Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0,0,0,0.5);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* è¿›å…¥æŒ‰é’®ç‰¹æ•ˆ */
Â  Â  Â  Â  #enter-btn {
Â  Â  Â  Â  Â  Â  background: transparent;Â 
Â  Â  Â  Â  Â  Â  color: #d4af37;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #d4af37;
Â  Â  Â  Â  Â  Â  padding: 18px 80px;Â 
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 8px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-family: inherit;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50px;Â 
Â  Â  Â  Â  Â  Â  transition: all 0.5s;
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  animation: fadeUp 1s ease-out 0.8s forwards;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #enter-btn::before {
Â  Â  Â  Â  Â  Â  content: '';Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: -100%;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
Â  Â  Â  Â  Â  Â  transition: 0.5s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #enter-btn:hover::before { left: 100%; transition: 0.7s; }
Â  Â  Â  Â  #enter-btn:hover {Â 
Â  Â  Â  Â  Â  Â  background: #d4af37;Â 
Â  Â  Â  Â  Â  Â  color: #000;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);Â 
Â  Â  Â  Â  Â  Â  transform: scale(1.05);Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes fadeUp {Â 
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: translateY(20px); }Â 
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ç¥ç§˜å­¦é—ªå…‰ç²’å­ */
Â  Â  Â  Â  .sparkle {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  background: white;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px #d4af37, 0 0 20px #d4af37;
Â  Â  Â  Â  Â  Â  animation: sparkleFloat linear forwards;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes sparkleFloat {
Â  Â  Â  Â  Â  Â  0% { opacity: 0; transform: translateY(0) scale(0); }
Â  Â  Â  Â  Â  Â  50% { opacity: 1; transform: translateY(-50px) scale(1); }
Â  Â  Â  Â  Â  Â  100% { opacity: 0; transform: translateY(-100px) scale(0); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- æ¸¸æˆå†… UI å±‚ --- */
Â  Â  Â  Â  #ui-layer {Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 0;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  z-index: 20;Â 
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  color: #d4af37;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 1.5s;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å†å²è®°å½•æ  */
Â  Â  Â  Â  #history-container {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 20px;Â 
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: row;Â 
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  pointer-events: auto;Â 
Â  Â  Â  Â  Â  Â  z-index: 30;Â 
Â  Â  Â  Â  Â  Â  height: 100px;Â 
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  transition: opacity 1s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .history-slot {
Â  Â  Â  Â  Â  Â  width: 50px;Â 
Â  Â  Â  Â  Â  Â  height: 85px;Â 
Â  Â  Â  Â  Â  Â  background: #fff;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #d4af37;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  justify-content: flex-end;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.8);Â 
Â  Â  Â  Â  Â  Â  flex-shrink: 0;Â 
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  animation: slotEnter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes slotEnter {Â 
Â  Â  Â  Â  Â  Â  from { opacity:0; transform: translateY(-20px); }Â 
Â  Â  Â  Â  Â  Â  to { opacity:1; transform: translateY(0); }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .history-slot img { position: absolute; top:0; left:0; width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .history-info { position: relative; z-index: 2; width: 100%; background: rgba(0,0,0,0.8); text-align: center; padding: 2px 0; border-top: 1px solid #d4af37; }
Â  Â  Â  Â  .history-name { font-size: 8px; color: #d4af37; font-weight: 700; white-space: nowrap; transform: scale(0.9); }
Â  Â  Â  Â  .history-rev { font-size: 7px; color: #ff3333; display: none; font-weight: bold; background: rgba(0,0,0,0.5); width:100%; }
Â  Â  Â  Â  .is-reversed img { transform: rotate(180deg); }
Â  Â  Â  Â  .is-reversed .history-rev { display: block; }

Â  Â  Â  Â  /* åº•éƒ¨ HUD */
Â  Â  Â  Â  #hud-center {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  bottom: 8%;Â 
Â  Â  Â  Â  Â  Â  left: 50%;Â 
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  color: #d4af37;Â 
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #gesture-icon { font-size: 32px; display: block; margin-bottom: 10px; opacity: 0.9; text-shadow: 0 0 15px #d4af37;}
Â  Â  Â  Â  #status-text { font-size: 11px; letter-spacing: 4px; text-transform: uppercase; font-weight: 600; opacity: 0.8; }

Â  Â  Â  Â  /* æœ€ç»ˆç»“æœæ–‡å­—å®¹å™¨ */
Â  Â  Â  Â  #final-text-container {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 65%; /* ç¨å¾®ä¸Šç§»ä»¥é€‚é…å°å±å¹• */
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 2s;
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  gap: 40px;Â 
Â  Â  Â  Â  Â  Â  flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
Â  Â  Â  Â  Â  Â  padding: 0 20px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .final-card-label {
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  width: 220px;Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 10px #d4af37;Â 
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  animation: textFloat 3s ease-in-out infinite alternate;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes textFloat { from { transform: translateY(0); } to { transform: translateY(-5px); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .final-name { font-size: 15px; font-weight: bold; color: #d4af37; margin-bottom: 8px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 5px; }
Â  Â  Â  Â  .final-meaning { font-size: 11px; color: #ccc; font-style: italic; line-height: 1.5; opacity: 0.8; }

Â  Â  Â  Â  /* é‡å¯æŒ‰é’®åŒºåŸŸ */
Â  Â  Â  Â  #end-ui {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  bottom: 12%;Â 
Â  Â  Â  Â  Â  Â  left: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 1.5s;Â 
Â  Â  Â  Â  Â  Â  z-index: 50;
Â  Â  Â  Â  }
Â  Â  Â  Â  #restart-btn {
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.7);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #d4af37;Â 
Â  Â  Â  Â  Â  Â  color: #d4af37;
Â  Â  Â  Â  Â  Â  padding: 12px 50px;Â 
Â  Â  Â  Â  Â  Â  font-size: 13px;Â 
Â  Â  Â  Â  Â  Â  letter-spacing: 4px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  font-family: inherit;Â 
Â  Â  Â  Â  Â  Â  transition: 0.4s;
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  Â  }
Â  Â  Â  Â  #restart-btn:hover { background: #d4af37; color: #000; box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); }

Â  Â  Â  Â  /* --- åˆ¶ä½œäººå‘˜ä¿¡æ¯ --- */
Â  Â  Â  Â  #credits {
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  bottom: 20px;Â 
Â  Â  Â  Â  Â  Â  right: 25px;
Â  Â  Â  Â  Â  Â  text-align: right;Â 
Â  Â  Â  Â  Â  Â  color: #a0a0a0;Â 
Â  Â  Â  Â  Â  Â  font-size: 10px;
Â  Â  Â  Â  Â  Â  line-height: 1.6;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 1.5s;
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  z-index: 50;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Noto Serif SC', serif;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #video-feed { position: absolute; bottom: 10px; right: 10px; width: 100px; opacity: 0; transform: scaleX(-1); pointer-events: none; border: 1px solid #d4af37; transition: opacity 0.5s; }
Â  Â  Â  Â  #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); color: #d4af37; letter-spacing: 6px; font-size: 12px; font-weight: bold; z-index: 200; }

Â  Â  Â  Â  /* --- ç§»åŠ¨ç«¯é€‚é… (Responsive Styles) --- */
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  h1 { font-size: 42px; letter-spacing: 8px; }
Â  Â  Â  Â  Â  Â  h2 { font-size: 10px; letter-spacing: 4px; }
Â  Â  Â  Â  Â  Â  .options-grid { grid-template-columns: 1fr; gap: 30px; margin-bottom: 30px; }
Â  Â  Â  Â  Â  Â  .choice-btn { padding: 10px 0; width: 200px; }
Â  Â  Â  Â  Â  Â  #enter-btn { padding: 15px 60px; font-size: 14px; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* ç§»åŠ¨ç«¯å†å²è®°å½•ç½®é¡¶å±…ä¸­ */
Â  Â  Â  Â  Â  Â  #history-container {
Â  Â  Â  Â  Â  Â  Â  Â  top: 10px;
Â  Â  Â  Â  Â  Â  Â  Â  right: 50%;
Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(50%);
Â  Â  Â  Â  Â  Â  Â  Â  height: 70px;
Â  Â  Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .history-slot { width: 40px; height: 65px; }
Â  Â  Â  Â  Â  Â  .history-name { font-size: 6px; }

Â  Â  Â  Â  Â  Â  /* HUD è°ƒæ•´ */
Â  Â  Â  Â  Â  Â  #hud-center { bottom: 15%; }
Â  Â  Â  Â  Â  Â  #status-text { font-size: 10px; letter-spacing: 2px; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* åˆ¶ä½œäººå‘˜ä¿¡æ¯ç¼©å° */
Â  Â  Â  Â  Â  Â  #credits { text-align: center; right: 0; width: 100%; bottom: 10px; font-size: 8px; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* æœ€ç»ˆç»“æœæ–‡å­—è°ƒæ•´ */
Â  Â  Â  Â  Â  Â  #final-text-container { top: 60%; gap: 15px; }
Â  Â  Â  Â  Â  Â  .final-card-label { width: 100%; max-width: 300px; }
Â  Â  Â  Â  }
Â  Â  </style>
Â  Â Â 
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body>
Â  Â  <div id="loader"></div>

Â  Â  <div id="start-screen">
Â  Â  Â  Â  <div class="title-group">
Â  Â  Â  Â  Â  Â  <h1>ARCANUM</h1>
Â  Â  Â  Â  Â  Â  <h2 id="subtitle">The Virtual Ritual</h2>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="options-grid">
Â  Â  Â  Â  Â  Â  <div class="option-group">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="option-label" id="lbl-language">Language / è¯­è¨€</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="choice-btn active" onclick="setLang('en')" id="btn-en">English</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="choice-btn" onclick="setLang('zh')" id="btn-zh">ä¸­æ–‡</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="option-group">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="option-label" id="lbl-input">Input / æ“æ§</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="choice-btn active" onclick="setInput('hand')" id="btn-hand">Hand Gesture âœ‹</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="choice-btn" onclick="setInput('mouse')" id="btn-mouse">Mouse / Touch ğŸ–±ï¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button id="enter-btn" onclick="enterExperience()">ENTER</button>
Â  Â  </div>

Â  Â  <div id="ui-layer">
Â  Â  Â  Â  <div id="history-container"></div>
Â  Â  Â  Â  <div id="final-text-container"></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="end-ui">
Â  Â  Â  Â  Â  Â  <button id="restart-btn" onclick="location.reload()">RESTART RITUAL</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="credits">
Â  Â  Â  Â  Â  Â  Jerry Hu & Gemini åˆ¶ä½œ<br>huqiuzhi10@gmail.com
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="hud-center">
Â  Â  Â  Â  Â  Â  <span id="gesture-icon">âœ‹</span>
Â  Â  Â  Â  Â  Â  <div id="status-text">Wave to Turn Â· Pinch to Select</div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <video id="video-feed" playsinline></video>
Â  Â  <div id="canvas-container"></div>

<script>
// æ£€æµ‹æ˜¯å¦ç§»åŠ¨è®¾å¤‡
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// 1. é—ªå…‰ç‰¹æ•ˆé€»è¾‘
function createSparkles() {
Â  Â  const screen = document.getElementById('start-screen');
Â  Â  if(screen.style.display === 'none') return;Â 

Â  Â  const sparkle = document.createElement('div');
Â  Â  sparkle.className = 'sparkle';
Â  Â Â 
Â  Â  // éšæœºä½ç½®
Â  Â  const x = Math.random() * 100;
Â  Â  const y = Math.random() * 100;
Â  Â  sparkle.style.left = x + '%';
Â  Â  sparkle.style.top = y + '%';
Â  Â Â 
Â  Â  // éšæœºå¤§å°å’ŒæŒç»­æ—¶é—´
Â  Â  const size = Math.random() * 3 + 1;Â 
Â  Â  sparkle.style.width = size + 'px';
Â  Â  sparkle.style.height = size + 'px';
Â  Â  sparkle.style.animationDuration = (Math.random() * 2 + 2) + 's';Â 
Â  Â Â 
Â  Â  screen.appendChild(sparkle);

Â  Â  // åŠ¨ç”»ç»“æŸåç§»é™¤
Â  Â  setTimeout(() => { sparkle.remove(); }, 4000);
}
setInterval(createSparkles, 200);


/**
Â * DATA & CONFIG
Â */
const TEXTS = {
Â  Â  en: {
Â  Â  Â  Â  subtitle: "The Virtual Ritual",
Â  Â  Â  Â  lblLang: "Language",
Â  Â  Â  Â  lblInput: "Input Method",
Â  Â  Â  Â  enter: "ENTER VOID",
Â  Â  Â  Â  statusWave: "Wave to Turn Â· Pinch Center Card",
Â  Â  Â  Â  statusMouse: "Move to Turn Â· Hold to Grab",
Â  Â  Â  Â  statusTouch: "Drag to Turn Â· Hold to Grab", // æ–°å¢ Touch æç¤º
Â  Â  Â  Â  statusFist: "FIST TO REVEAL",
Â  Â  Â  Â  statusSpace: "SPACE / HOLD TO REVEAL",
Â  Â  Â  Â  statusReveal: "OBSERVING FATE...",
Â  Â  Â  Â  statusDone: "RITUAL COMPLETE",
Â  Â  Â  Â  rev: "Reversed",
Â  Â  Â  Â  restart: "RESTART RITUAL",
Â  Â  Â  Â  btnHand: "Hand Gesture âœ‹",Â 
Â  Â  Â  Â  btnMouse: isMobile ? "Touch Control ğŸ‘†" : "Mouse Control ğŸ–±ï¸"Â  Â  Â  Â Â 
Â  Â  },
Â  Â  zh: {
Â  Â  Â  Â  subtitle: "è™šæ‹Ÿå¡”ç½—ä»ªå¼",
Â  Â  Â  Â  lblLang: "è¯­è¨€è®¾ç½®",
Â  Â  Â  Â  lblInput: "æ“æ§æ–¹å¼",
Â  Â  Â  Â  enter: "è¿›å…¥è™šç©º",
Â  Â  Â  Â  statusWave: "æŒ¥æ‰‹è½¬åŠ¨ç‰Œé˜µ Â· æåˆæ‰‹æŒ‡é€‰ä¸­",
Â  Â  Â  Â  statusMouse: "ç§»åŠ¨é¼ æ ‡è½¬åŠ¨ Â· æŒ‰ä½å·¦é”®æŠ“å–",
Â  Â  Â  Â  statusTouch: "æ»‘åŠ¨è½¬åŠ¨ Â· é•¿æŒ‰æŠ“å–/æ­ç¤º", // æ–°å¢ Touch æç¤º
Â  Â  Â  Â  statusFist: "æ¡æ‹³æ­ç¤ºå‘½è¿",
Â  Â  Â  Â  statusSpace: "æŒ‰ç©ºæ ¼ / é•¿æŒ‰æ­ç¤º",
Â  Â  Â  Â  statusReveal: "æ­£åœ¨è§‚æµ‹å‘½è¿...",
Â  Â  Â  Â  statusDone: "ä»ªå¼å®Œæˆ",
Â  Â  Â  Â  rev: "é€†ä½",
Â  Â  Â  Â  restart: "é‡æ–°å¼€å§‹ä»ªå¼",
Â  Â  Â  Â  btnHand: "æ‰‹åŠ¿æ§åˆ¶ âœ‹",Â 
Â  Â  Â  Â  btnMouse: isMobile ? "è§¦å±æ§åˆ¶ ğŸ‘†" : "é¼ æ ‡æ§åˆ¶ ğŸ–±ï¸"Â Â 
Â  Â  }
};

// åŸºç¡€æ•°æ® (å®Œæ•´22å¼ )
const RWS_DATA = [
Â  Â  { id: 0, en: { name: "The Fool", meaning: "New beginnings, innocence, spontaneity" }, zh: { name: "æ„šè€…", meaning: "æ–°çš„å¼€å§‹ï¼Œå¤©çœŸï¼Œè‡ªå‘æ€§ï¼Œå†’é™©" } },
Â  Â  { id: 1, en: { name: "The Magician", meaning: "Manifestation, resourcefulness, power" }, zh: { name: "é­”æœ¯å¸ˆ", meaning: "æ˜¾åŒ–ï¼Œèµ„æºä¸°å¯Œï¼ŒåŠ›é‡ï¼Œåˆ›é€ åŠ›" } },
Â  Â  { id: 2, en: { name: "High Priestess", meaning: "Intuition, sacred knowledge" }, zh: { name: "å¥³ç¥­å¸", meaning: "ç›´è§‰ï¼Œç¥åœ£çŸ¥è¯†ï¼Œæ½œæ„è¯†ï¼Œç¥ç§˜" } },
Â  Â  { id: 3, en: { name: "The Empress", meaning: "Femininity, beauty, nature" }, zh: { name: "çš‡å", meaning: "å¥³æ€§åŠ›é‡ï¼Œç¾ä¸½ï¼Œè‡ªç„¶ï¼Œå­•è‚²" } },
Â  Â  { id: 4, en: { name: "The Emperor", meaning: "Authority, establishment" }, zh: { name: "çš‡å¸", meaning: "æƒå¨ï¼Œä½“åˆ¶ï¼Œç»“æ„ï¼Œæ§åˆ¶" } },
Â  Â  { id: 5, en: { name: "The Hierophant", meaning: "Spiritual wisdom, beliefs" }, zh: { name: "æ•™çš‡", meaning: "ç²¾ç¥æ™ºæ…§ï¼Œä¿¡ä»°ï¼Œä¼ ç»Ÿï¼Œæ•™å¯¼" } },
Â  Â  { id: 6, en: { name: "The Lovers", meaning: "Love, harmony, choices" }, zh: { name: "æ‹äºº", meaning: "çˆ±ï¼Œå’Œè°ï¼Œå…³ç³»ï¼Œé€‰æ‹©" } },
Â  Â  { id: 7, en: { name: "The Chariot", meaning: "Control, willpower, success" }, zh: { name: "æˆ˜è½¦", meaning: "æ§åˆ¶ï¼Œæ„å¿—åŠ›ï¼ŒæˆåŠŸï¼Œè¡ŒåŠ¨" } },
Â  Â  { id: 8, en: { name: "Strength", meaning: "Strength, courage, persuasion" }, zh: { name: "åŠ›é‡", meaning: "åŠ›é‡ï¼Œå‹‡æ°”ï¼Œè¯´æœï¼Œå½±å“åŠ›" } },
Â  Â  { id: 9, en: { name: "The Hermit", meaning: "Soul-searching, introspection" }, zh: { name: "éšå£«", meaning: "æ¢ç´¢å†…å¿ƒï¼Œå†…çœï¼Œç‹¬å¤„ï¼ŒæŒ‡å¼•" } },
Â  Â  { id: 10, en: { name: "Wheel of Fortune", meaning: "Good luck, karma, destiny" }, zh: { name: "å‘½è¿ä¹‹è½®", meaning: "å¥½è¿ï¼Œä¸šåŠ›ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œå‘½è¿" } },
Â  Â  { id: 11, en: { name: "Justice", meaning: "Justice, fairness, truth" }, zh: { name: "æ­£ä¹‰", meaning: "æ­£ä¹‰ï¼Œå…¬å¹³ï¼ŒçœŸç†ï¼Œå› æœ" } },
Â  Â  { id: 12, en: { name: "Hanged Man", meaning: "Pause, surrender, letting go" }, zh: { name: "å€’åŠäºº", meaning: "æš‚åœï¼Œè‡£æœï¼Œæ”¾æ‰‹ï¼Œæ–°è§†è§’" } },
Â  Â  { id: 13, en: { name: "Death", meaning: "Endings, change, transformation" }, zh: { name: "æ­»ç¥", meaning: "ç»“æŸï¼Œæ”¹å˜ï¼Œè½¬åŒ–ï¼Œè¿‡æ¸¡" } },
Â  Â  { id: 14, en: { name: "Temperance", meaning: "Balance, moderation, patience" }, zh: { name: "èŠ‚åˆ¶", meaning: "å¹³è¡¡ï¼Œé€‚åº¦ï¼Œè€å¿ƒï¼Œç›®æ ‡" } },
Â  Â  { id: 15, en: { name: "The Devil", meaning: "Shadow self, addiction" }, zh: { name: "æ¶é­”", meaning: "é˜´æš—é¢ï¼Œæ‰§ç€ï¼Œæˆç˜¾ï¼ŒæŸç¼š" } },
Â  Â  { id: 16, en: { name: "The Tower", meaning: "Sudden change, upheaval" }, zh: { name: "é«˜å¡”", meaning: "çªå˜ï¼Œå‰§å˜ï¼Œæ··ä¹±ï¼Œå¯ç¤º" } },
Â  Â  { id: 17, en: { name: "The Star", meaning: "Hope, faith, renewal" }, zh: { name: "æ˜Ÿæ˜Ÿ", meaning: "å¸Œæœ›ï¼Œä¿¡å¿µï¼Œç›®æ ‡ï¼Œæ–°ç”Ÿ" } },
Â  Â  { id: 18, en: { name: "The Moon", meaning: "Illusion, fear, anxiety" }, zh: { name: "æœˆäº®", meaning: "å¹»è§‰ï¼Œææƒ§ï¼Œç„¦è™‘ï¼Œæ½œæ„è¯†" } },
Â  Â  { id: 19, en: { name: "The Sun", meaning: "Positivity, fun, warmth" }, zh: { name: "å¤ªé˜³", meaning: "ç§¯æï¼Œå¿«ä¹ï¼Œæ¸©æš–ï¼ŒæˆåŠŸ" } },
Â  Â  { id: 20, en: { name: "Judgement", meaning: "Judgement, rebirth, calling" }, zh: { name: "å®¡åˆ¤", meaning: "å®¡åˆ¤ï¼Œé‡ç”Ÿï¼Œå†…å¿ƒå¬å”¤ï¼Œèµ¦å…" } },
Â  Â  { id: 21, en: { name: "The World", meaning: "Completion, integration" }, zh: { name: "ä¸–ç•Œ", meaning: "å®Œæˆï¼Œæ•´åˆï¼Œæˆå°±ï¼Œåœ†æ»¡" } }
];

let currentLang = 'en';
// å¦‚æœæ˜¯æ‰‹æœºï¼Œé»˜è®¤ä½¿ç”¨ Mouse/Touch æ¨¡å¼ï¼Œé¿å… MediaPipe æ€§èƒ½é—®é¢˜æˆ–æƒé™é—®é¢˜å¹²æ‰°ä½“éªŒ
let controlMode = isMobile ? 'mouse' : 'hand';Â 
let isStarted = false;
let deckList = [];

// Game Logic Params
const MAX_SELECTION = 3;Â 
let selectionCount = 0;
let isRitualComplete = false;
let chosen3DMeshes = [];

const RADIUS = 6.5;
const CARD_W = 1.5;
const CARD_H = 2.58;
const CORNER_R = 0.08;
const GOLD_COLOR = 0xd4af37;
const BG_COLOR = 0x000000;

// åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
window.onload = function() {
Â  Â  setInput(controlMode);
Â  Â  updateStartScreenText();
};

function setLang(lang) {
Â  Â  currentLang = lang;
Â  Â  document.querySelectorAll('[onclick^="setLang"]').forEach(b => b.classList.remove('active'));
Â  Â  document.getElementById(`btn-${lang}`).classList.add('active');
Â  Â  updateStartScreenText();
}

function setInput(mode) {
Â  Â  controlMode = mode;
Â  Â  document.querySelectorAll('[onclick^="setInput"]').forEach(b => b.classList.remove('active'));
Â  Â  document.getElementById(`btn-${mode}`).classList.add('active');
}

function updateStartScreenText() {
Â  Â  const t = TEXTS[currentLang];
Â  Â  document.getElementById('subtitle').innerText = t.subtitle;
Â  Â  document.getElementById('lbl-language').innerText = t.lblLang;
Â  Â  document.getElementById('lbl-input').innerText = t.lblInput;
Â  Â  document.getElementById('enter-btn').innerText = t.enter;
Â  Â  document.getElementById('restart-btn').innerText = t.restart;
Â  Â  // æ›´æ–°æŒ‰é’®æ–‡å­—
Â  Â  document.getElementById('btn-hand').innerText = t.btnHand;
Â  Â  document.getElementById('btn-mouse').innerText = t.btnMouse;
}

function enterExperience() {
Â  Â  isStarted = true;
Â  Â  const screen = document.getElementById('start-screen');
Â  Â  screen.style.opacity = 0;
Â  Â  screen.style.pointerEvents = 'none';Â 
Â  Â  setTimeout(() => { screen.style.display = 'none'; }, 1500);
Â  Â  const ui = document.getElementById('ui-layer');
Â  Â  ui.style.opacity = 1;
Â  Â Â 
Â  Â  // åˆå§‹åŒ–è¾“å…¥ç›‘å¬
Â  Â  if (controlMode === 'hand') {
Â  Â  Â  Â  document.getElementById('video-feed').style.opacity = 0.3;
Â  Â  Â  Â  initCamera();
Â  Â  } else {
Â  Â  Â  Â  initMouseListeners();
Â  Â  Â  Â  initTouchListeners(); // å¢åŠ è§¦æ‘¸ç›‘å¬
Â  Â  }
Â  Â Â 
Â  Â  updateCameraPos(); // ç¡®ä¿ç›¸æœºä½ç½®æ­£ç¡®
Â  Â  updateStatusText();
Â  Â  spawnDeck();
}

/**
Â * THREE.JS SCENE SETUP
Â */
const scene = new THREE.Scene();
scene.background = new THREE.Color(BG_COLOR);
scene.fog = new THREE.FogExp2(BG_COLOR, 0.012);
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 100);
// åˆå§‹ä½ç½®ç”± updateCameraPos å†³å®š

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
document.getElementById('canvas-container').appendChild(renderer.domElement);

const texLoader = new THREE.TextureLoader();
const texBackGlobal = texLoader.load('./cards/back.png');Â 
texBackGlobal.anisotropy = renderer.capabilities.getMaxAnisotropy();
texBackGlobal.center.set(0.5, 0.5);

const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
scene.add(ambientLight);
const frontLight = new THREE.DirectionalLight(0xffeaac, 0.6);
frontLight.position.set(0, 2, 5);
scene.add(frontLight);

// Stars
const starGeo = new THREE.BufferGeometry();
const starPos = new Float32Array(2500*3);
for(let i=0;i<2500;i++) {
Â  Â  const r = 20 + Math.random()*40;
Â  Â  const theta = Math.random()*Math.PI*2;
Â  Â  const phi = Math.acos(Math.random()*2-1);
Â  Â  starPos[i*3] = r*Math.sin(phi)*Math.cos(theta);
Â  Â  starPos[i*3+1] = r*Math.sin(phi)*Math.sin(theta);
Â  Â  starPos[i*3+2] = r*Math.cos(phi);
}
starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
const starMat = new THREE.PointsMaterial({color: 0xcccccc, size: 0.06});
const starSystem = new THREE.Points(starGeo, starMat);
scene.add(starSystem);

/**
Â * DECK CONSTRUCTION
Â */
const deckGroup = new THREE.Group();
scene.add(deckGroup);
let cardObjects = [];

const shape = new THREE.Shape();
const w = CARD_W/2, h = CARD_H/2, r = CORNER_R;
shape.moveTo(-w+r, -h); shape.lineTo(w-r, -h); shape.quadraticCurveTo(w, -h, w, -h+r);
shape.lineTo(w, h-r); shape.quadraticCurveTo(w, h, w-r, h);
shape.lineTo(-w+r, h); shape.quadraticCurveTo(-w, h, -w, h-r);
shape.lineTo(-w, -h+r); shape.quadraticCurveTo(-w, -h, -w+r, -h);
const faceGeo = new THREE.ShapeGeometry(shape);

function fixUVs(geometry) {
Â  Â  const posAttribute = geometry.attributes.position;
Â  Â  const uvAttribute = geometry.attributes.uv;
Â  Â  for (let i = 0; i < posAttribute.count; i++) {
Â  Â  Â  Â  const x = posAttribute.getX(i);
Â  Â  Â  Â  const y = posAttribute.getY(i);
Â  Â  Â  Â  uvAttribute.setXY(i, (x / CARD_W) + 0.5, (y / CARD_H) + 0.5);
Â  Â  }
Â  Â  uvAttribute.needsUpdate = true;
}
fixUVs(faceGeo);

const matBase = { roughness: 0.6, metalness: 0.1 };
const edgeMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee, ...matBase });
const outlineGeo = new THREE.EdgesGeometry(faceGeo);
const outlineMat = new THREE.LineBasicMaterial({ color: GOLD_COLOR, linewidth: 2 });

function createCardMesh(data, index, total) {
Â  Â  const group = new THREE.Group();
Â  Â  const texFront = texLoader.load(data.url);
Â  Â  texFront.anisotropy = renderer.capabilities.getMaxAnisotropy();
Â  Â  texFront.center.set(0.5, 0.5);
Â  Â Â 
Â  Â  const matBack = new THREE.MeshStandardMaterial({ map: texBackGlobal, ...matBase });
Â  Â  const matFront = new THREE.MeshStandardMaterial({ map: texFront, ...matBase });

Â  Â  const meshBack = new THREE.Mesh(faceGeo, matBack);
Â  Â  meshBack.position.z = 0.005;Â 
Â  Â  const meshFront = new THREE.Mesh(faceGeo, matFront);
Â  Â  meshFront.rotation.y = Math.PI;
Â  Â  meshFront.position.z = -0.005;
Â  Â  const meshFiller = new THREE.Mesh(faceGeo, edgeMat);
Â  Â  meshFiller.scale.set(0.995, 0.995, 1);
Â  Â  const outlineMesh = new THREE.LineSegments(outlineGeo, outlineMat);
Â  Â  outlineMesh.position.z = 0.006; outlineMesh.visible = false;
Â  Â  group.userData.outline = outlineMesh;

Â  Â  group.add(meshBack, meshFront, meshFiller, outlineMesh);
Â  Â Â 
Â  Â  const step = (Math.PI * 2) / total;
Â  Â  const theta = index * step;
Â  Â  group.position.x = RADIUS * Math.sin(theta);
Â  Â  group.position.z = -RADIUS * Math.cos(theta);
Â  Â  group.lookAt(0, 0, 0);

Â  Â  group.userData = { id: data.id, rawData: data, state: 'IDLE', theta: theta, isChosen: false };
Â  Â  return group;
}

function spawnDeck() {
Â  Â  if(!isStarted) return;
Â  Â  deckGroup.clear(); cardObjects = [];
Â  Â Â 
Â  Â  // ç”Ÿæˆå¸¦è·¯å¾„æ•°æ®
Â  Â  deckList = RWS_DATA.map(d => ({
Â  Â  Â  Â  ...d,
Â  Â  Â  Â  url: `./cards/${d.id}.png`
Â  Â  }));

Â  Â  deckList.sort(() => Math.random() - 0.5);
Â  Â Â 
Â  Â  deckList.forEach((item, i) => {
Â  Â  Â  Â  const card = createCardMesh(item, i, deckList.length);
Â  Â  Â  Â  deckGroup.add(card);
Â  Â  Â  Â  cardObjects.push(card);
Â  Â  });
Â  Â  document.getElementById('loader').style.display = 'none';
}

/**
Â * INTERACTION LOGIC
Â */
let handState = 'OPEN';
let handX = 0;
let ringRotation = 0;
let activeCard = null;
let centerCard = null;

function initMouseListeners() {
Â  Â  window.addEventListener('mousemove', (e) => {
Â  Â  Â  Â  handX = (e.clientX / window.innerWidth) * 2 - 1;
Â  Â  });
Â  Â  window.addEventListener('mousedown', (e) => {
Â  Â  Â  Â  if(e.button === 0) handState = 'PINCH';Â 
Â  Â  Â  Â  updateCursorIcon();
Â  Â  });
Â  Â  window.addEventListener('mouseup', () => {
Â  Â  Â  Â  handState = 'OPEN';
Â  Â  Â  Â  updateCursorIcon();
Â  Â  });
Â  Â  window.addEventListener('keydown', (e) => {
Â  Â  Â  Â  if(e.code === 'Space') handState = 'FIST';Â 
Â  Â  Â  Â  updateCursorIcon();
Â  Â  });
Â  Â  window.addEventListener('keyup', (e) => {
Â  Â  Â  Â  if(e.code === 'Space' && handState === 'FIST') handState = 'PINCH';Â 
Â  Â  Â  Â  else if (e.code === 'Space') handState = 'OPEN';
Â  Â  Â  Â  updateCursorIcon();
Â  Â  });
}

// æ–°å¢ï¼šè§¦æ‘¸äº‹ä»¶ç›‘å¬ (Mobile Support)
function initTouchListeners() {
Â  Â  const container = document.getElementById('canvas-container');
Â  Â Â 
Â  Â  container.addEventListener('touchmove', (e) => {
Â  Â  Â  Â  e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
Â  Â  Â  Â  const touch = e.touches[0];
Â  Â  Â  Â  // æ¨¡æ‹Ÿé¼ æ ‡Xè½´ç§»åŠ¨ï¼Œæ§åˆ¶æ—‹è½¬
Â  Â  Â  Â  handX = (touch.clientX / window.innerWidth) * 2 - 1;
Â  Â  }, { passive: false });

Â  Â  container.addEventListener('touchstart', (e) => {
Â  Â  Â  Â  const touch = e.touches[0];
Â  Â  Â  Â  handX = (touch.clientX / window.innerWidth) * 2 - 1;
Â  Â  Â  Â  // è§¦æ‘¸å¼€å§‹è§†ä¸º"æåˆ"å‡†å¤‡ï¼Œé•¿æŒ‰æˆ–æ“ä½œç”± handleInput å†³å®š
Â  Â  Â  Â  handState = 'PINCH';Â 
Â  Â  Â  Â  updateCursorIcon();
Â  Â  }, { passive: false });

Â  Â  container.addEventListener('touchend', (e) => {
Â  Â  Â  Â  handState = 'OPEN';
Â  Â  Â  Â  updateCursorIcon();
Â  Â  });
}

function updateCursorIcon() {
Â  Â  const icon = handState==='FIST'?'âœŠ':(handState==='PINCH'?'ğŸ¤': (isMobile ? 'ğŸ‘†' : 'ğŸ–±ï¸'));
Â  Â  document.getElementById('gesture-icon').innerText = icon;
}

function updateStatusText() {
Â  Â  const t = TEXTS[currentLang];
Â  Â  const el = document.getElementById('status-text');
Â  Â  if (isRitualComplete) {
Â  Â  Â  Â  el.innerText = t.statusDone;
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (activeCard && activeCard.userData.state === 'SELECTED') {
Â  Â  Â  Â  el.innerText = controlMode === 'hand' ? t.statusFist : t.statusSpace;
Â  Â  } else if (activeCard && activeCard.userData.state === 'REVEALING') {
Â  Â  Â  Â  el.innerText = t.statusReveal;
Â  Â  } else {
Â  Â  Â  Â  if (controlMode === 'hand') el.innerText = t.statusWave;
Â  Â  Â  Â  else el.innerText = isMobile ? t.statusTouch : t.statusMouse; // åŒºåˆ†è§¦æ‘¸å’Œé¼ æ ‡æç¤º
Â  Â  }
}

function handleInput() {
Â  Â  if (!isStarted) return;
Â  Â  if (isRitualComplete) {
Â  Â  Â  Â  animateFinalFormation();
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  if (!activeCard && handState === 'OPEN') {
Â  Â  Â  Â  const deadZone = 0.15;
Â  Â  Â  Â  // ç§»åŠ¨ç«¯çµæ•åº¦è°ƒæ•´
Â  Â  Â  Â  const speed = isMobile ? 0.04 : 0.02;
Â  Â  Â  Â  if (Math.abs(handX) > deadZone) ringRotation += (handX - Math.sign(handX)*deadZone) * speed;
Â  Â  }
Â  Â  deckGroup.rotation.y = THREE.MathUtils.lerp(deckGroup.rotation.y, ringRotation, 0.05);

Â  Â  let closestDist = Infinity;
Â  Â  let newCenterCard = null;
Â  Â  if (!activeCard) {
Â  Â  Â  Â  cardObjects.forEach(card => {
Â  Â  Â  Â  Â  Â  if (card.userData.state === 'IDLE' && !card.userData.isChosen) {
Â  Â  Â  Â  Â  Â  Â  Â  const worldPos = new THREE.Vector3();
Â  Â  Â  Â  Â  Â  Â  Â  card.getWorldPosition(worldPos);
Â  Â  Â  Â  Â  Â  Â  Â  // ç§»åŠ¨ç«¯åˆ¤å®šèŒƒå›´æ”¾å®½
Â  Â  Â  Â  Â  Â  Â  Â  if (worldPos.z < -RADIUS + 2.5 && Math.abs(worldPos.x) < (isMobile ? 2.0 : 1.5)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dist = worldPos.distanceTo(camera.position);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dist < closestDist) { closestDist = dist; newCenterCard = card; }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (card.userData.outline) card.userData.outline.visible = false;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  if (newCenterCard) {
Â  Â  Â  Â  centerCard = newCenterCard;
Â  Â  Â  Â  if (centerCard.userData.outline) centerCard.userData.outline.visible = true;
Â  Â  } else {
Â  Â  Â  Â  centerCard = null;
Â  Â  }

Â  Â  // äº¤äº’é€»è¾‘ç»Ÿä¸€ï¼šé¼ æ ‡æŒ‰ä¸‹æˆ–è§¦æ‘¸ï¼ˆPINCHï¼‰é€‰ä¸­
Â  Â  // å¯¹äº Mobileï¼Œä¸ºäº†åŒºåˆ†æ»‘åŠ¨å’Œç‚¹å‡»ï¼Œå¯ä»¥ç”¨ç®€å•çš„é€»è¾‘ï¼šå¦‚æœæ‰‹åŠ¿å¤„äº PINCH ä½†æ²¡æœ‰å¤§å¹…åº¦ç§»åŠ¨ handXï¼Œåˆ™è§†ä¸ºé€‰ä¸­
Â  Â  if (handState === 'PINCH' && centerCard && !activeCard) selectCard(centerCard);

Â  Â  if (activeCard) {
Â  Â  Â  Â  // é€‰ä¸­åçš„å¡ç‰Œä½ç½®
Â  Â  Â  Â  const targetZ = isMobile ? -3.5 : -2.2; // ç§»åŠ¨ç«¯ç¨å¾®è¿œä¸€ç‚¹ï¼Œæˆ–è€…æ ¹æ®ç›¸æœºä½ç½®è°ƒæ•´
Â  Â  Â  Â  activeCard.position.lerp(new THREE.Vector3(0, 0, targetZ), 0.1);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (activeCard.userData.state === 'SELECTED') {
Â  Â  Â  Â  Â  Â  const idleQ = new THREE.Quaternion().setFromEuler(new THREE.Euler(0, 0, 0));
Â  Â  Â  Â  Â  Â  activeCard.quaternion.slerp(idleQ, 0.1);
Â  Â  Â  Â  Â  Â  updateStatusText();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ç§»åŠ¨ç«¯é•¿æŒ‰æ¨¡æ‹Ÿ FIST (è¿™é‡Œç®€åŒ–é€»è¾‘ï¼šå¦‚æœæ˜¯ Touch æ¨¡å¼ï¼Œé•¿æ—¶é—´ PINCH è§†ä¸ºç¡®è®¤æ­ç¤º)
Â  Â  Â  Â  Â  Â  // ä¸ºäº†ç®€åŒ–ï¼ŒTouch æ¨¡å¼ä¸‹åªè¦å†æ¬¡ç‚¹å‡»(PINCH) æˆ–è€… æ‰‹åŠ¿æ¨¡å¼ä¸‹ FIST å³å¯
Â  Â  Â  Â  Â  Â  if (handState === 'FIST' || (controlMode === 'mouse' && handState === 'PINCH')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â // ç¨å¾®åŠ ä¸ªå»¶è¿Ÿé˜²æ­¢è¯¯è§¦
Â  Â  Â  Â  Â  Â  Â  Â  Â if(!activeCard.userData.revealTimer) activeCard.userData.revealTimer = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  Â if(Date.now() - activeCard.userData.revealTimer > 500) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â revealCard(activeCard);
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  } else if (handState === 'OPEN') {
Â  Â  Â  Â  Â  Â  Â  Â  activeCard.userData.revealTimer = null;
Â  Â  Â  Â  Â  Â  Â  Â  returnCard(activeCard);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  updateStatusText();
Â  Â  }
}

function selectCard(card) {
Â  Â  if (selectionCount >= MAX_SELECTION) return;
Â  Â  activeCard = card;
Â  Â  card.userData.state = 'SELECTED';
Â  Â  card.userData.revealTimer = Date.now(); // åˆå§‹åŒ–è®¡æ—¶å™¨
Â  Â  if(card.userData.outline) card.userData.outline.visible = false;
Â  Â  scene.attach(card);Â 
}

function returnCard(card) {
Â  Â  deckGroup.attach(card);
Â  Â  card.userData.state = 'RETURNING';
Â  Â  activeCard = null;
}

function updateReturningCards() {
Â  Â  cardObjects.forEach(card => {
Â  Â  Â  Â  if (card.userData.state === 'RETURNING') {
Â  Â  Â  Â  Â  Â  const targetPos = new THREE.Vector3(
Â  Â  Â  Â  Â  Â  Â  Â  RADIUS * Math.sin(card.userData.theta),Â 
Â  Â  Â  Â  Â  Â  Â  Â  0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  -RADIUS * Math.cos(card.userData.theta)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  card.position.lerp(targetPos, 0.08);Â 
Â  Â  Â  Â  Â  Â  const dummy = new THREE.Object3D();
Â  Â  Â  Â  Â  Â  dummy.position.copy(card.position);
Â  Â  Â  Â  Â  Â  dummy.lookAt(0,0,0);
Â  Â  Â  Â  Â  Â  card.quaternion.slerp(dummy.quaternion, 0.08);
Â  Â  Â  Â  Â  Â  if (card.position.distanceTo(targetPos) < 0.05) {
Â  Â  Â  Â  Â  Â  Â  Â  card.userData.state = 'IDLE';
Â  Â  Â  Â  Â  Â  Â  Â  card.position.copy(targetPos);
Â  Â  Â  Â  Â  Â  Â  Â  card.lookAt(0,0,0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });
}

function revealCard(card) {
Â  Â  if (card.userData.state === 'REVEALING') return;
Â  Â  card.userData.state = 'REVEALING';
Â  Â  updateStatusText();
Â  Â Â 
Â  Â  const isReversed = Math.random() < 0.5;
Â  Â  card.userData.isReversed = isReversed;

Â  Â  const startQ = card.quaternion.clone();
Â  Â  const targetEuler = new THREE.Euler(0, Math.PI, isReversed ? Math.PI : 0);
Â  Â  const targetQ = new THREE.Quaternion().setFromEuler(targetEuler);

Â  Â  const data = card.userData.rawData;
Â  Â  const name = data[currentLang].name;

Â  Â  let p = 0;
Â  Â  function animateFlip() {
Â  Â  Â  Â  p += 0.03;Â 
Â  Â  Â  Â  card.quaternion.slerpQuaternions(startQ, targetQ, p);
Â  Â  Â  Â  if (p < 1) {
Â  Â  Â  Â  Â  Â  requestAnimationFrame(animateFlip);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  card.rotation.set(0, Math.PI, isReversed ? Math.PI : 0);
Â  Â  Â  Â  Â  Â  document.getElementById('status-text').innerText = name.toUpperCase();
Â  Â  Â  Â  Â  Â  setTimeout(() => { dissolve(card, isReversed); }, 2000);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  animateFlip();
}

function dissolve(card, isReversed) {
Â  Â  spawnParticles(card.position);
Â  Â  selectionCount++;
Â  Â  addToHistory(card.userData.rawData, isReversed);
Â  Â  card.visible = false;
Â  Â  card.userData.isChosen = true;
Â  Â  activeCard = null;
Â  Â  chosen3DMeshes.push(card);Â 
Â  Â  if (selectionCount >= MAX_SELECTION) startEndRitual();
}

function startEndRitual() {
Â  Â  isRitualComplete = true;
Â  Â  updateStatusText();
Â  Â Â 
Â  Â  document.getElementById('history-container').style.opacity = 0;
Â  Â  document.getElementById('hud-center').style.opacity = 0;
Â  Â Â 
Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.getElementById('end-ui').style.opacity = 1;
Â  Â  Â  Â  document.getElementById('end-ui').style.pointerEvents = 'auto';
Â  Â  Â  Â  document.getElementById('credits').style.opacity = 1;
Â  Â  }, 3500);

Â  Â  cardObjects.forEach(c => {
Â  Â  Â  Â  if (!c.userData.isChosen) {
Â  Â  Â  Â  Â  Â  c.userData.dropSpeed = 0.05 + Math.random() * 0.1;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  chosen3DMeshes.forEach((card, index) => {
Â  Â  Â  Â  card.visible = true;
Â  Â  Â  Â  scene.attach(card);Â 
Â  Â  Â  Â  // ç»“æŸåŠ¨ç”»èµ·å§‹ä½ç½®
Â  Â  Â  Â  card.position.set(4 + index*0.5, 3, -4);Â 
Â  Â  Â  Â  card.scale.set(0.2, 0.2, 0.2);

Â  Â  Â  Â  // å“åº”å¼æœ€ç»ˆä½ç½®è®¡ç®—
Â  Â  Â  Â  // æ‰‹æœºå±å¹•çª„ï¼Œéœ€è¦æ’åˆ—æ›´ç´§å‡‘æˆ–è€…å‚ç›´æ’åˆ—ï¼Œè¿™é‡Œåšç®€å•ç¼©æ”¾é€‚é…
Â  Â  Â  Â  const isPortrait = window.innerHeight > window.innerWidth;
Â  Â  Â  Â  const gap = isPortrait ? 1.4 : 2.4;
Â  Â  Â  Â  const depth = isPortrait ? -2 : -6.0; // æ‰‹æœºä¸Šæ”¾è¿œä¸€ç‚¹
Â  Â  Â  Â Â 
Â  Â  Â  Â  card.userData.finalTargetPos = new THREE.Vector3((index - 1) * gap, 0, depth);
Â  Â  Â  Â  card.userData.finalTargetScale = 0.8;
Â  Â  Â  Â  card.userData.animProgress = 0;
Â  Â  Â  Â  card.userData.animDelay = index * 30;Â 
Â  Â  });

Â  Â  const textContainer = document.getElementById('final-text-container');
Â  Â  const t = TEXTS[currentLang];
Â  Â Â 
Â  Â  chosen3DMeshes.forEach(card => {
Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  div.className = 'final-card-label';
Â  Â  Â  Â  const data = card.userData.rawData[currentLang];
Â  Â  Â  Â  const revText = card.userData.isReversed ? ` (${t.rev})` : "";
Â  Â  Â  Â  div.innerHTML = `<div class="final-name">${data.name}${revText}</div><div class="final-meaning">${data.meaning}</div>`;
Â  Â  Â  Â  textContainer.appendChild(div);
Â  Â  });
Â  Â  setTimeout(() => { textContainer.style.opacity = 1; }, 2000);
}

function animateFinalFormation() {
Â  Â  cardObjects.forEach(c => {
Â  Â  Â  Â  if (!c.userData.isChosen && c.position.y > -10) {
Â  Â  Â  Â  Â  Â  c.position.y -= c.userData.dropSpeed;
Â  Â  Â  Â  Â  Â  c.rotation.x += 0.05;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  chosen3DMeshes.forEach(card => {
Â  Â  Â  Â  if (card.userData.animDelay > 0) {
Â  Â  Â  Â  Â  Â  card.userData.animDelay--;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (card.userData.animProgress < 1) {
Â  Â  Â  Â  Â  Â  card.userData.animProgress += 0.015;Â 
Â  Â  Â  Â  Â  Â  const t = card.userData.animProgress;
Â  Â  Â  Â  Â  Â  const easeT = t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;Â 
Â  Â  Â  Â  Â  Â  card.position.lerp(card.userData.finalTargetPos, 0.05);
Â  Â  Â  Â  Â  Â  const s = THREE.MathUtils.lerp(0.2, card.userData.finalTargetScale, easeT);
Â  Â  Â  Â  Â  Â  card.scale.set(s, s, s);
Â  Â  Â  Â  Â  Â  const isRev = card.userData.isReversed;
Â  Â  Â  Â  Â  Â  card.rotation.set(0, Math.PI, isRev ? Math.PI : 0);
Â  Â  Â  Â  }
Â  Â  });
}

function addToHistory(rawData, isRev) {
Â  Â  const con = document.getElementById('history-container');Â 
Â  Â  const slot = document.createElement('div');Â 
Â  Â  slot.className = `history-slot ${isRev?'is-reversed':''}`;
Â  Â  const t = TEXTS[currentLang];
Â  Â  const data = rawData[currentLang];
Â  Â  slot.innerHTML = `<img src="${rawData.url}"><div class="history-info"><div class="history-name">${data.name}</div><div class="history-rev">${t.rev}</div></div>`;
Â  Â  con.appendChild(slot);Â 
}

const particles = [];
function spawnParticles(pos) {
Â  Â  const count = 500; const geo = new THREE.BufferGeometry(); const pArr = new Float32Array(count*3); const vArr = new Float32Array(count*3);
Â  Â  for(let i=0;i<count;i++) {
Â  Â  Â  Â  pArr[i*3]=pos.x+(Math.random()-0.5)*CARD_W; pArr[i*3+1]=pos.y+(Math.random()-0.5)*CARD_H; pArr[i*3+2]=pos.z;
Â  Â  Â  Â  vArr[i*3]=(Math.random()-0.5)*0.02; vArr[i*3+1]=Math.random()*0.03; vArr[i*3+2]=(Math.random()-0.5)*0.02;
Â  Â  }
Â  Â  geo.setAttribute('position', new THREE.BufferAttribute(pArr,3));
Â  Â  const mat = new THREE.PointsMaterial({color: GOLD_COLOR, size:0.04, transparent:true});
Â  Â  const sys = new THREE.Points(geo,mat); sys.userData={life:1.0, vels:vArr}; scene.add(sys); particles.push(sys);
}
function updateParticles() {
Â  Â  for(let i=particles.length-1;i>=0;i--) {
Â  Â  Â  Â  const sys=particles[i], p=sys.geometry.attributes.position.array, v=sys.userData.vels; sys.userData.life-=0.02;
Â  Â  Â  Â  for(let j=0;j<p.length/3;j++){ p[j*3]+=v[j*3]; p[j*3+1]+=v[j*3+1]; p[j*3+2]+=v[j*3+2]; }
Â  Â  Â  Â  sys.geometry.attributes.position.needsUpdate=true; sys.material.opacity=sys.userData.life;
Â  Â  Â  Â  if(sys.userData.life<=0){scene.remove(sys); particles.splice(i,1);}
Â  Â  }
}

function initCamera() {
Â  Â  const videoElem = document.getElementById('video-feed');
Â  Â  const hands = new Hands({locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
Â  Â  hands.setOptions({maxNumHands:1, modelComplexity:0, minDetectionConfidence:0.5});
Â  Â  hands.onResults(res => {
Â  Â  Â  Â  if(res.multiHandLandmarks && res.multiHandLandmarks.length>0) {
Â  Â  Â  Â  Â  Â  const lm = res.multiHandLandmarks[0];
Â  Â  Â  Â  Â  Â  handX += ((1-lm[8].x)*2-1 - handX)*0.2;
Â  Â  Â  Â  Â  Â  const pinch = Math.hypot(lm[8].x-lm[4].x, lm[8].y-lm[4].y);
Â  Â  Â  Â  Â  Â  const fist = lm[12].y>lm[9].y && lm[16].y>lm[13].y;
Â  Â  Â  Â  Â  Â  handState = fist ? 'FIST' : (pinch<0.05 ? 'PINCH' : 'OPEN');
Â  Â  Â  Â  Â  Â  if (!isRitualComplete) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('gesture-icon').innerText = handState==='FIST'?'âœŠ':(handState==='PINCH'?'ğŸ‘Œ':'âœ‹');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });
Â  Â  const cam = new Camera(videoElem, {onFrame: async()=>{await hands.send({image:videoElem})}, width:320, height:240});
Â  Â  cam.start();
}

// å“åº”å¼ç›¸æœºä½ç½®æ›´æ–°
function updateCameraPos() {
Â  Â  const aspect = window.innerWidth / window.innerHeight;
Â  Â  camera.aspect = aspect;
Â  Â  camera.updateProjectionMatrix();
Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â Â 
Â  Â  // å…³é”®ï¼šç«–å±æ¨¡å¼ä¸‹ç›¸æœºåé€€ï¼Œä»¥ä¾¿çœ‹åˆ°å®Œæ•´çš„ç‰Œé˜µç¯
Â  Â  if (aspect < 1) { // ç«–å±
Â  Â  Â  Â  camera.position.z = 1; // è·ç¦»æ›´è¿œ
Â  Â  Â  Â  camera.position.y = 1;
Â  Â  } else { // æ¨ªå±
Â  Â  Â  Â  camera.position.z = 0;
Â  Â  Â  Â  camera.position.y = 0;
Â  Â  }
}

function animate() {
Â  Â  requestAnimationFrame(animate);
Â  Â  starSystem.rotation.y += 0.0002;
Â  Â  if (isStarted) {
Â  Â  Â  Â  handleInput();Â 
Â  Â  Â  Â  updateReturningCards();Â 
Â  Â  Â  Â  updateParticles();
Â  Â  }
Â  Â  renderer.render(scene, camera);
}
animate();

window.onresize = updateCameraPos;
</script>
</body>
</html>  
